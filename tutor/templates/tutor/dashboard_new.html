<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ tutor.name }}'s Pet Updates</title>
    {% load static %}
    {% load custom_filters %}
    <link rel="icon" href="{% static 'favicon.ico' %}">
    <title>Tails Pets üêï</title>
    <link rel="stylesheet" href="{% static 'tutor/style.css' %}">
    <style>
      :root {
        --primary: #FF6B6B;
        --secondary: #4ECDC4;
        --success: #27AE60;
        --warning: #E67E22;
        --danger: #dc3545;
        --info: #3498DB;
        --dark: #2C3E50;
        --light: #ECF0F1;
        --gray: #95A5A6;
      }

      header {
        background: linear-gradient(135deg, var(--secondary) 0%, #45b8ae 100%);
        background-size: cover;
        background-position: center;
        padding: 40px 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        position: relative;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      {% if business.banner_image %}
      header {
        background-image: url('{{ business.banner_image.url }}');
      }
      {% else %}
      header {
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect fill="%234ECDC4" width="200" height="100"/><circle cx="50" cy="40" r="15" fill="%23fff"/><circle cx="60" cy="35" r="8" fill="%23333"/><circle cx="100" cy="50" r="20" fill="%23fff"/><circle cx="110" cy="45" r="10" fill="%23333"/><ellipse cx="75" cy="70" rx="20" ry="15" fill="%23f4a460"/><path d="M 50 55 Q 55 65 60 55" stroke="%23333" stroke-width="2" fill="none"/><path d="M 95 70 Q 100 80 105 70" stroke="%23333" stroke-width="2" fill="none"/></svg>');
      }
      {% endif %}

      .hamburger {
        display: none;
        flex-direction: column;
        gap: 6px;
        cursor: pointer;
        background: white;
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
      }

      .hamburger span {
        width: 24px;
        height: 3px;
        background: var(--secondary);
        border-radius: 2px;
      }

      .hamburger.active span:nth-child(1) {
        transform: rotate(45deg) translate(8px, 8px);
      }

      .hamburger.active span:nth-child(2) {
        opacity: 0;
      }

      .hamburger.active span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -7px);
      }

      .mobile-menu {
        display: none;
        position: absolute;
        top: 100%;
        right: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        flex-direction: column;
        gap: 8px;
        padding: 12px;
        min-width: 200px;
        z-index: 100;
      }

      .mobile-menu.show {
        display: flex;
      }

      .mobile-menu .header-btn {
        padding: 10px 16px;
        font-size: 13px;
        width: 100%;
        text-align: left;
        justify-content: flex-start;
      }

      @media (max-width: 768px) {
        .hamburger {
          display: flex;
        }

        .header-nav {
          display: none;
        }
      }

      header h1 {
        color: white;
        font-size: 32px;
        margin: 0 0 20px 0;
        font-weight: 700;
      }

      .header-nav {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .header-btn {
        padding: 12px 24px;
        background: white;
        color: var(--secondary);
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .header-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(255,255,255,0.3);
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 30px 20px;
      }

      /* TABS */
      .tabs {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
        border-bottom: 2px solid #e0e0e0;
        padding: 0 0 10px 0;
      }

      .tab-btn {
        padding: 12px 24px;
        background: transparent;
        border: none;
        border-bottom: 3px solid transparent;
        font-weight: 600;
        color: var(--gray);
        cursor: pointer;
        font-size: 15px;
        transition: all 0.3s ease;
      }

      .tab-btn:hover {
        color: var(--secondary);
      }

      .tab-btn.active {
        color: var(--secondary);
        border-bottom-color: var(--secondary);
      }

      .tab-content {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .tab-content.active {
        display: block;
      }

      /* FOOTER STYLES */
      .app-footer {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: #e0e0e0;
        padding: 60px 20px 20px 20px;
        margin-top: 80px;
        border-top: 3px solid var(--secondary);
      }

      .footer-content {
        max-width: 1400px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 40px;
        margin-bottom: 30px;
      }

      .footer-section h4 {
        color: var(--secondary);
        margin-bottom: 15px;
        font-size: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .footer-brand h3 {
        color: var(--secondary);
        font-size: 28px;
        margin: 0 0 8px 0;
      }

      .footer-tagline {
        color: #999;
        font-size: 13px;
        margin: 0;
      }

      .footer-links {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .footer-links li {
        margin-bottom: 10px;
      }

      .footer-links a {
        color: #b0b0b0;
        text-decoration: none;
        transition: color 0.3s ease;
        font-size: 14px;
      }

      .footer-links a:hover {
        color: var(--secondary);
      }

      .footer-section p {
        margin: 8px 0;
        font-size: 13px;
        line-height: 1.6;
        color: #b0b0b0;
      }

      .footer-social {
        display: flex;
        gap: 15px;
      }

      .footer-social a {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        background: rgba(78, 205, 196, 0.2);
        border: 2px solid var(--secondary);
        border-radius: 50%;
        color: var(--secondary);
        text-decoration: none;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .footer-social a:hover {
        background: var(--secondary);
        color: white;
        transform: translateY(-3px);
      }

      .footer-bottom {
        max-width: 1400px;
        margin: 0 auto;
        padding-top: 20px;
        border-top: 1px solid rgba(78, 205, 196, 0.2);
        text-align: center;
        font-size: 12px;
        color: #888;
      }

      /* FOOTER STYLES */
      .app-footer {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: #e0e0e0;
        padding: 60px 20px 20px 20px;
        margin-top: 80px;
        border-top: 3px solid var(--secondary);
      }

      .footer-content {
        max-width: 1400px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 40px;
        margin-bottom: 30px;
      }

      .footer-section h4 {
        color: var(--secondary);
        margin-bottom: 15px;
        font-size: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .footer-brand h3 {
        color: var(--secondary);
        font-size: 28px;
        margin: 0 0 8px 0;
      }

      .footer-tagline {
        color: #999;
        font-size: 13px;
        margin: 0;
      }

      .footer-links {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .footer-links li {
        margin-bottom: 10px;
      }

      .footer-links a {
        color: #b0b0b0;
        text-decoration: none;
        transition: color 0.3s ease;
        font-size: 14px;
      }

      .footer-links a:hover {
        color: var(--secondary);
      }

      .footer-section p {
        margin: 8px 0;
        font-size: 13px;
        line-height: 1.6;
        color: #b0b0b0;
      }

      .footer-social {
        display: flex;
        gap: 15px;
      }

      .footer-social a {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        background: rgba(78, 205, 196, 0.2);
        border: 2px solid var(--secondary);
        border-radius: 50%;
        color: var(--secondary);
        text-decoration: none;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .footer-social a:hover {
        background: var(--secondary);
        color: white;
        transform: translateY(-3px);
      }

      .footer-bottom {
        max-width: 1400px;
        margin: 0 auto;
        padding-top: 20px;
        border-top: 1px solid rgba(78, 205, 196, 0.2);
        text-align: center;
        font-size: 12px;
        color: #888;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      /* FEED STYLING */
      .feed {
        padding: 12px 6px 40px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .feed-item {
        background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.92));
        padding: 18px 18px 16px;
        border-radius: 16px;
        border: 1px solid rgba(78,205,196,0.16);
        box-shadow: 0 18px 32px rgba(0,0,0,0.08);
        transition: all 0.25s ease;
      }

      .feed-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 18px 38px rgba(78,205,196,0.16);
        border-color: var(--secondary);
      }

      .feed-header {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 10px;
        margin-bottom: 10px;
        align-items: center;
      }

      .label {
        background: linear-gradient(135deg, #4ECDC4, #3fb1a6);
        color: white;
        padding: 6px 12px;
        border-radius: 999px;
        font-weight: 700;
        font-size: 12px;
        letter-spacing: 0.3px;
        box-shadow: 0 6px 14px rgba(78,205,196,0.35);
      }

      .feed-header strong {
        color: #0f172a;
        font-weight: 800;
        font-size: 17px;
        letter-spacing: 0.2px;
      }

      .feed-header span {
        color: #5b6474;
        font-size: 12px;
        text-align: right;
      }

      .media {
        width: 100%;
        max-height: 520px;
        border-radius: 14px;
        margin: 12px 0 10px;
        object-fit: cover;
      }

      .caption {
        color: #0f172a;
        margin: 10px 0 6px;
        line-height: 1.8;
        font-size: 16px;
        font-weight: 600;
        word-break: break-word;
      }

      .reply {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #f0f0f0;
      }

      .reply-item {
        background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        padding: 10px 12px;
        border-radius: 10px;
        margin-bottom: 10px;
        border: 1px solid rgba(0,0,0,0.03);
      }

      .reply-item-author {
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 6px;
        display: flex;
        gap: 6px;
        align-items: center;
      }

      .reply-item-text {
        color: var(--dark);
        line-height: 1.5;
      }

      .reply-item:last-child {
        margin-bottom: 0;
      }

      .reply-form {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 15px;
      }

      .reply-form textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-family: inherit;
        font-size: 14px;
        resize: vertical;
        min-height: 65px;
        background: white;
        transition: all 0.3s ease;
      }

      .reply-form textarea:focus {
        outline: none;
        border-color: var(--secondary);
        box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        background: white;
      }

      .reply-form button {
        align-self: flex-start;
        padding: 10px 24px;
        background: var(--secondary);
        color: white;
        border: none;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .reply-form button:hover {
        background: #45b8ae;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
      }
      }

      /* CALENDAR SECTION */
      .calendar-section {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
      }

      .calendar-header h3 {
        font-size: 20px;
        color: var(--dark);
        margin: 0;
      }

      .nav-btn {
        background: var(--secondary);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .nav-btn:hover {
        background: #45b8ae;
        transform: scale(1.05);
      }

      .calendar-weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
        margin-bottom: 10px;
      }

      .calendar-weekdays div {
        text-align: center;
        font-weight: 700;
        color: var(--gray);
        font-size: 13px;
        text-transform: uppercase;
        padding: 10px;
      }

      .calendar-days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
      }

      .calendar-day-cell {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        cursor: pointer;
        background: #f9f9f9;
        border: 2px solid #e0e0e0;
        transition: all 0.3s ease;
        position: relative;
        font-weight: 600;
      }

      .calendar-day-cell:hover {
        border-color: var(--secondary);
        background: white;
        transform: scale(1.05);
      }

      .calendar-day-cell.other-month {
        opacity: 0.3;
        cursor: default;
      }

      .calendar-day-cell.other-month:hover {
        transform: scale(1);
      }

      .calendar-day-cell.has-confirmed-booking {
        background: linear-gradient(135deg, var(--success) 0%, #229954 100%);
        color: white;
        border-color: var(--success);
      }

      .calendar-day-cell.has-pending-booking {
        background: linear-gradient(135deg, var(--warning) 0%, #d68910 100%);
        color: white;
        border-color: var(--warning);
      }

      .calendar-day-cell.has-rejected-booking {
        background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
        color: white;
        border-color: var(--danger);
      }

      .booking-status {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: white;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
      }

      .calendar-day-cell.has-pending-booking .booking-status {
        animation: pulse 2s infinite;
      }

      /* MODAL */
      .slot-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .slot-modal.show {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 16px;
        padding: 30px;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        animation: slideUp 0.3s ease;
      }

      @keyframes slideUp {
        from {
          transform: translateY(30px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-header {
        font-size: 20px;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--gray);
      }

      .service-selection {
        display: grid;
        gap: 10px;
        margin-bottom: 20px;
      }

      .service-btn {
        padding: 15px;
        background: #f9f9f9;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .service-btn:hover {
        border-color: var(--secondary);
        background: white;
      }

      .service-btn.selected {
        background: var(--secondary);
        color: white;
        border-color: var(--secondary);
      }

      .time-slots-container {
        display: none;
        margin-bottom: 20px;
      }

      .time-slot-option {
        display: flex;
        gap: 10px;
        align-items: center;
        padding: 12px;
        background: #f9f9f9;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .time-slot-option input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }

      .time-slot-option label {
        flex: 1;
        cursor: pointer;
        font-weight: 500;
      }

      .time-slot-btn {
        display: block;
        width: 100%;
        padding: 12px;
        margin-bottom: 10px;
        background: #f9f9f9;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .time-slot-btn:hover {
        border-color: var(--secondary);
        background: white;
      }

      .time-slot-btn.selected {
        background: var(--secondary);
        color: white;
        border-color: var(--secondary);
      }

      .time-slot-btn:disabled,
      .time-slot-btn[disabled] {
        background: #f5f5f5;
        color: #999;
        border-color: #ddd;
        cursor: not-allowed;
        opacity: 0.6;
      }

      .time-slot-btn:disabled:hover,
      .time-slot-btn[disabled]:hover {
        background: #f5f5f5;
        border-color: #ddd;
      }

      .time-slot-option input[type="checkbox"]:disabled + label {
        color: #999;
        cursor: not-allowed;
      }

      .booking-form-container {
        display: none;
        background: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark);
        font-size: 14px;
      }

      .form-group select, .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-family: inherit;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .form-group select:focus, .form-group textarea:focus {
        outline: none;
        border-color: var(--secondary);
        box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
      }

      .form-group textarea {
        resize: vertical;
        min-height: 80px;
      }

      .booking-submit {
        width: 100%;
        padding: 14px;
        background: var(--secondary);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        font-size: 15px;
        transition: all 0.3s ease;
        text-transform: uppercase;
      }

      .booking-submit:hover {
        background: #45b8ae;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(78, 205, 196, 0.3);
      }

      /* MINI CALENDAR STYLES */
      .mini-cal-day-header {
        text-align: center;
        font-weight: 700;
        color: var(--gray);
        padding: 4px 0;
        text-transform: uppercase;
        font-size: 9px;
      }

      .mini-cal-day-header {
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        cursor: default;
        background: #f0f0f0;
        color: var(--dark);
        font-weight: 700;
        font-size: 10px;
        border: 1px solid #ddd;
        aspect-ratio: 1;
      }

      .mini-cal-day {
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: white;
        color: var(--dark);
        font-weight: 500;
        font-size: 11px;
        border: 1px solid #ddd;
        aspect-ratio: 1;
      }

      .mini-cal-day:hover {
        background: var(--secondary);
        color: white;
      }

      .mini-cal-day.other-month {
        color: var(--gray);
        opacity: 0.5;
      }

      .mini-cal-day.has-booking {
        background: linear-gradient(135deg, var(--secondary) 0%, #45b8ae 100%);
        color: white;
        font-weight: 700;
        box-shadow: 0 2px 8px rgba(78, 205, 196, 0.3);
      }

      .mini-cal-day.has-booking.confirmed {
        background: linear-gradient(135deg, var(--success) 0%, #229954 100%);
      }

      .mini-cal-day.has-booking.pending {
        background: linear-gradient(135deg, var(--warning) 0%, #d68910 100%);
      }

      .mini-cal-day.today {
        border: 2px solid var(--secondary);
      }

      /* LARGE CALENDAR STYLES */
      .large-cal-day-header {
        text-align: center;
        font-weight: 700;
        color: var(--dark);
        padding: 12px;
        background: #f8f9fa;
        border-radius: 8px;
        font-size: 13px;
        text-transform: uppercase;
      }

      .large-cal-day {
        min-height: 100px;
        padding: 10px;
        border-radius: 10px;
        background: white;
        border: 2px solid #e5e7eb;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
      }

      .large-cal-day:hover {
        border-color: var(--secondary);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(78, 205, 196, 0.2);
      }

      .large-cal-day-number {
        font-weight: 700;
        font-size: 16px;
        color: var(--dark);
        margin-bottom: 6px;
      }

      .large-cal-day.other-month {
        opacity: 0.4;
        background: #f9f9f9;
      }

      .large-cal-day.today {
        border-color: var(--secondary);
        border-width: 3px;
        background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(78, 205, 196, 0.05));
      }

      .large-cal-day.has-booking {
        background: linear-gradient(135deg, rgba(78, 205, 196, 0.15), rgba(78, 205, 196, 0.05));
        border-color: var(--secondary);
      }

      .booking-badge {
        font-size: 12px;
        padding: 6px 10px;
        border-radius: 8px;
        font-weight: 600;
        margin-bottom: 6px;
        display: block;
        width: 100%;
        text-align: left;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .booking-badge.confirmed {
        background: var(--success);
        color: white;
      }

      .booking-badge.pending {
        background: var(--warning);
        color: white;
      }

      .booking-time {
        font-size: 11px;
        opacity: 0.95;
        margin-top: 3px;
        font-weight: 500;
      }

      @media (max-width: 768px) {
        header h1 {
          font-size: 24px;
        }

        .header-nav {
          justify-content: space-between;
        }

        .modal-content {
          margin: 20px;
          max-width: 100%;
        }

        .calendar-days {
          gap: 5px;
        }

        .tabs {
          gap: 10px;
        }

        .tab-btn {
          padding: 10px 16px;
          font-size: 13px;
        }
      }
    </style>
  </head>
  <body>
    <header{% if business.banner_image %} style="background-image: url('{{ business.banner_image.url }}');"{% endif %}>
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>üêï {{ tutor.name }}'s Pet Updates</h1>
        <button class="hamburger" onclick="toggleMenu()">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div class="header-nav">
        <button class="header-btn" onclick="switchTab(event, 'feed-tab')">üì∞ Feed</button>
        <button class="header-btn" onclick="switchTab(event, 'schedule-tab')">üìÖ Schedule</button>
        <a href="{% url 'tutor:profile' %}" class="header-btn">üë§ My Profile</a>
        <a href="{% url 'account_logout' %}" class="header-btn" style="background: #FF6B6B; color: white;">üö™ Logout</a>
      </div>
      <div class="mobile-menu" id="mobile-menu">
        <button class="header-btn" onclick="switchTab(event, 'feed-tab')" style="margin: 0;">üì∞ Feed</button>
        <button class="header-btn" onclick="switchTab(event, 'schedule-tab')" style="margin: 0;">üìÖ Schedule</button>
        <a href="{% url 'tutor:profile' %}" class="header-btn" style="margin: 0;">üë§ My Profile</a>
        <a href="{% url 'account_logout' %}" class="header-btn" style="background: #FF6B6B; color: white; margin: 0;">üö™ Logout</a>
      </div>
    </header>

    <div class="container">
      <!-- FEED TAB -->
      <div id="feed-tab" class="tab-content active">
        {% if not pets %}
        <div style="background: linear-gradient(135deg, var(--secondary) 0%, #45b8ae 100%); padding: 40px; border-radius: 16px; color: white; text-align: center; margin-bottom: 30px;">
          <div style="font-size: 48px; margin-bottom: 16px;">üêï</div>
          <h2 style="color: white; margin-bottom: 12px;">Welcome to Tails Pet Daycare!</h2>
          <p style="font-size: 16px; margin-bottom: 20px; opacity: 0.95;">You haven't added any pets yet. Let's get started by adding your first pet.</p>
          <a href="{% url 'tutor:create_pet' %}" style="display: inline-block; padding: 12px 24px; background: white; color: var(--secondary); text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 14px; transition: all 0.3s ease;">
            + Add Your First Pet
          </a>
        </div>
        {% endif %}

        <h2 style="font-size: 24px; margin-bottom: 20px; color: var(--dark);">Your Pets</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
          {% for pet in pets %}
          <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
              {% if pet.photo %}
                <img src="{{ pet.photo.url }}" alt="{{ pet.name }} photo" style="width:50px;height:50px;object-fit:cover;border-radius:50%;border:2px solid var(--secondary);" />
              {% else %}
                <img src="{% static 'staff/dog_placeholder.svg' %}" alt="No photo" style="width:50px;height:50px;border-radius:50%;border:2px solid var(--secondary);background:#f0f0f0;" />
              {% endif %}
              <div style="flex: 1;">
                <div style="font-weight: 700; font-size: 18px; color: var(--dark);">{{ pet.name }}</div>
                <div style="font-size: 12px; color: var(--gray);">{{ pet.species|default:"Pet" }}</div>
              </div>
            </div>
            {% with checkin=pet_checkins|get_item:pet.id %}
              {% if checkin and checkin.is_present %}
                <div style="background: var(--success); color: white; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; text-align: center; margin-bottom: 12px;">
                  ‚úÖ In Daycare
                </div>
              {% else %}
                <div style="background: var(--gray); color: white; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; text-align: center; margin-bottom: 12px;">
                  üè† At Home
                </div>
              {% endif %}
            {% endwith %}

            <!-- MINI CALENDAR (NEXT 15 DAYS) -->
            <div class="mini-calendar" id="mini-cal-{{ pet.id }}" style="background: #f9f9f9; border-radius: 10px; padding: 12px; border: 1px solid #e0e0e0; margin-bottom: 12px;">
              <div style="font-size: 12px; font-weight: 700; color: var(--dark); margin-bottom: 10px;">üìÖ Next 15 Days</div>
              <div class="mini-calendar-grid" id="mini-grid-{{ pet.id }}" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; padding: 8px 0;"></div>
            </div>

            <a href="/tutor/pet/{{ pet.id }}/?phone={{ tutor.phone }}" style="display: block; background: var(--secondary); color: white; text-align: center; padding: 10px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s ease;">
              üêæ View Profile
            </a>
          </div>
          {% endfor %}
        </div>

        <h2 style="font-size: 24px; margin-bottom: 20px; color: var(--dark);">Recent Updates from {{ business.name|default:"Your Daycare" }}</h2>
        {% if feed %}
        <div class="feed">
        {% for item in feed %}
        <div class="feed-item">
          <div class="feed-header">
            <span class="label">[{% if item.kind == 'business' %}{{ business.name|default:'Business' }}{% else %}{{ item.label }}{% endif %}]</span>
            <strong>
              {% if item.author_staff %}{{ item.author_staff.first_name }}{% elif item.author_tutor %}{{ item.author_tutor.name }}{% else %}Update{% endif %}
            </strong>
            <span>{{ item.created_at|date:"M d, H:i" }}</span>
          </div>

          {% if item.attachment %}
            {% if item.attachment.url|is_video %}
              <video class="media" controls playsinline>
                <source src="{{ item.attachment.url }}" type="video/mp4">
              </video>
            {% elif item.attachment.url|is_image %}
              <img class="media" src="{{ item.attachment.url }}" alt="attachment" />
            {% else %}
              <a href="{{ item.attachment.url }}" target="_blank">üìé Attachment</a>
            {% endif %}
          {% endif %}

          {% if item.message %}
          <div class="caption">{{ item.message }}</div>
          {% endif %}

          {% if item.woof or item.global %}
          <div class="reply">
            {% if item.woof %}
              {% for reply in item.woof.woof_set.all %}
              <div class="reply-item">
                <div class="reply-item-author">{% if reply.staff %}{{ reply.staff.first_name }}{% elif reply.tutor %}{{ reply.tutor.name }}{% else %}Reply{% endif %} ¬∑ {{ reply.created_at|time:"H:i" }}</div>
                {% if reply.attachment %}
                  {% if reply.attachment.url|is_video %}
                    <video class="media" controls playsinline style="max-height: 250px;">
                      <source src="{{ reply.attachment.url }}" type="video/mp4">
                    </video>
                  {% elif reply.attachment.url|is_image %}
                    <img class="media" src="{{ reply.attachment.url }}" alt="attachment" style="max-height: 250px;" />
                  {% else %}
                    <a href="{{ reply.attachment.url }}" target="_blank">üìé Attachment</a>
                  {% endif %}
                {% endif %}
                {% if reply.message %}
                <div class="reply-item-text">{{ reply.message }}</div>
                {% endif %}
              </div>
              {% empty %}
              <div style="font-size:12px; color:#888;">No replies yet.</div>
              {% endfor %}
            {% endif %}
            {% if item.global %}
              {% for reply in item.global.woof_set.all %}
              <div class="reply-item">
                <div class="reply-item-author">{% if reply.staff %}{{ reply.staff.first_name }}{% elif reply.tutor %}{{ reply.tutor.name }}{% else %}Reply{% endif %} ¬∑ {{ reply.created_at|time:"H:i" }}</div>
                {% if reply.attachment %}
                  {% if reply.attachment.url|is_video %}
                    <video class="media" controls playsinline style="max-height: 250px;">
                      <source src="{{ reply.attachment.url }}" type="video/mp4">
                    </video>
                  {% elif reply.attachment.url|is_image %}
                    <img class="media" src="{{ reply.attachment.url }}" alt="attachment" style="max-height: 250px;" />
                  {% else %}
                    <a href="{{ reply.attachment.url }}" target="_blank">üìé Attachment</a>
                  {% endif %}
                {% endif %}
                {% if reply.message %}
                <div class="reply-item-text">{{ reply.message }}</div>
                {% endif %}
              </div>
              {% empty %}
              <div style="font-size:12px; color:#888;">No replies yet.</div>
              {% endfor %}
            {% endif %}
          </div>

          <form class="reply-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {% if item.woof %}
            <input type="hidden" name="action" value="woof_reply_tutor">
            <input type="hidden" name="parent_woof_id" value="{{ item.woof.id }}">
            {% elif item.global %}
            <input type="hidden" name="action" value="woof_reply_global">
            <input type="hidden" name="global_woof_id" value="{{ item.global.id }}">
            {% endif %}
            <textarea name="woof_message" placeholder="Reply..." maxlength="140" required></textarea>
            <input type="file" name="woof_attachment" accept="image/*,video/*" />
            <button type="submit">üí¨ Reply</button>
          </form>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div style="text-align: center; padding: 40px; color: var(--gray);">
        <p style="font-size: 16px;">No updates yet. Check back soon! üêæ</p>
      </div>
      {% endif %}
      </div><!-- end feed-tab -->

      <!-- SCHEDULE TAB -->
      <div id="schedule-tab" class="tab-content">
        <h2 style="font-size: 24px; margin-bottom: 30px; color: var(--dark);">üìÖ Book a Service</h2>
        
        {% if pets %}
        <div style="background: white; border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
          <div style="margin-bottom: 30px;">
            <h3 style="font-size: 16px; color: var(--dark); margin-bottom: 10px; font-weight: 600;">üìÖ Click a date to book:</h3>
            <p style="color: var(--gray); font-size: 14px;">Pick a day ‚Üí Select your pet, service & time ‚Üí Done!</p>
          </div>
          
          <!-- SINGLE CALENDAR FOR ALL PETS -->
          <div class="large-calendar-grid" id="main-calendar" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 30px;">
            <!-- Calendar will be rendered here -->
          </div>
          
          <div style="padding-top: 20px; border-top: 2px solid #f0f0f0; color: var(--gray); font-size: 13px;">
            <strong>Legend:</strong> 
            <span style="margin-left: 20px;">
              <span style="display: inline-block; width: 12px; height: 12px; background: var(--success); border-radius: 50%; margin-right: 5px; vertical-align: middle;"></span> Confirmed
            </span>
            <span style="margin-left: 20px;">
              <span style="display: inline-block; width: 12px; height: 12px; background: var(--warning); border-radius: 50%; margin-right: 5px; vertical-align: middle;"></span> Pending
            </span>
            <span style="margin-left: 20px;">
              <span style="display: inline-block; width: 12px; height: 12px; background: #e0e0e0; border-radius: 50%; margin-right: 5px; vertical-align: middle;"></span> Available
            </span>
          </div>
        </div>
        {% else %}
        <div style="text-align: center; padding: 60px; color: var(--gray);">
          <p style="font-size: 18px;">No pets yet. Add a pet to start booking services! üêæ</p>
          <a href="{% url 'tutor:create_pet' %}" style="display: inline-block; margin-top: 20px; padding: 12px 24px; background: var(--secondary); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
            + Add Your First Pet
          </a>
        </div>
        {% endif %}
        
        <!-- BOOKING MODAL -->
        <div class="slot-modal" id="slot-modal">
          <div class="modal-content">
            <div class="modal-header">
              <span>Book Service for <span id="modal-selected-date"></span></span>
              <button class="modal-close" onclick="closeSlotModal()">‚úï</button>
            </div>
            
            <form method="post" id="booking-form" onsubmit="return validateBookingForm(event)">
              {% csrf_token %}
              <input type="hidden" name="action" value="book_service">
              <input type="hidden" name="selected_slots" id="selected-slots-input">
              <input type="hidden" name="selected_service_type" id="selected-service-type-input">
              <input type="hidden" name="pet_id" id="hidden-pet-id">
              
              <!-- PET SELECTION -->
              <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 10px;">üêï Select Your Pet</label>
                <select id="booking-pet-select" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;" onchange="updatePetSelection()">
                  <option value="">Choose a pet...</option>
                  {% for pet in pets %}
                  <option value="{{ pet.id }}">{{ pet.name }}</option>
                  {% endfor %}
                </select>
              </div>
              
              <!-- SERVICE SELECTION -->
              <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 10px;">‚úÇÔ∏è Select Service Type</label>
                <div id="service-options" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                  <!-- Services will be populated here -->
                </div>
              </div>
              
              <!-- TIME SLOT SELECTION -->
              <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 10px;">‚è∞ Select Time</label>
                <div id="time-slots-container" style="display: grid; gap: 8px;">
                  <!-- Time slots will be populated here -->
                </div>
              </div>
              
              <!-- NOTES -->
              <div class="form-group" style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 10px;">üìù Notes (Optional)</label>
                <textarea name="booking_notes" placeholder="Any special instructions..." style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; min-height: 80px; font-family: inherit;"></textarea>
              </div>
              
              <button type="submit" class="booking-submit" style="width: 100%; padding: 14px; background: var(--secondary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px; transition: all 0.3s ease;">
                ‚úÖ Confirm Booking
              </button>
            </form>
          </div>
        </div>
      </div><!-- end schedule-tab -->
    </div>

    <script>
      let currentDate = new Date();
      let selectedDate = null;
      let selectedPetId = null;
      let selectedService = null;
      const slotsData = {{ slots_json|safe }};
      const bookingsData = {{ bookings_json|safe }};
      const petBookingsData = {{ pet_bookings_json|safe }};
      let selectedSlots = [];

      // NEW FLOW: Pet ‚Üí Service ‚Üí Calendar
      
      function onPetSelected() {
        selectedPetId = document.getElementById('selected-pet').value;
        
        if (!selectedPetId) {
          // Disable service and calendar steps
          document.getElementById('service-step').style.opacity = '0.5';
          document.getElementById('service-step').style.pointerEvents = 'none';
          document.getElementById('calendar-step').style.opacity = '0.5';
          document.getElementById('calendar-step').style.pointerEvents = 'none';
          return;
        }
        
        // Enable service step
        document.getElementById('service-step').style.opacity = '1';
        document.getElementById('service-step').style.pointerEvents = 'auto';
        
        // Populate service buttons
        const serviceTypes = [...new Set(Object.values(slotsData).flat().map(s => s.service_type))];
        const serviceButtons = document.getElementById('service-buttons');
        serviceButtons.innerHTML = '';
        
        serviceTypes.forEach(serviceType => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'service-btn';
          btn.textContent = serviceType.toUpperCase();
          btn.style.padding = '10px 20px';
          btn.style.borderRadius = '6px';
          btn.style.border = '2px solid #ddd';
          btn.style.backgroundColor = 'white';
          btn.style.cursor = 'pointer';
          btn.style.fontSize = '14px';
          btn.style.fontWeight = '600';
          btn.style.transition = 'all 0.3s';
          btn.onclick = (e) => {
            e.preventDefault();
            onServiceSelected(serviceType);
          };
          serviceButtons.appendChild(btn);
        });
        
        // Disable calendar step until service is selected
        document.getElementById('calendar-step').style.opacity = '0.5';
        document.getElementById('calendar-step').style.pointerEvents = 'none';
      }
      
      function onServiceSelected(serviceType) {
        selectedService = serviceType;
        
        // Update button styles
        document.querySelectorAll('.service-btn').forEach(btn => {
          if (btn.textContent === serviceType.toUpperCase()) {
            btn.style.backgroundColor = '#FF6B9D';
            btn.style.color = 'white';
            btn.style.borderColor = '#FF6B9D';
          } else {
            btn.style.backgroundColor = 'white';
            btn.style.color = 'black';
            btn.style.borderColor = '#ddd';
          }
        });
        
        // Enable calendar step
        document.getElementById('calendar-step').style.opacity = '1';
        document.getElementById('calendar-step').style.pointerEvents = 'auto';
        
        // Render calendar filtered by service type
        renderCalendar();
      }

      function switchTab(event, tabName) {
        if (event) event.preventDefault();
        
        // Close mobile menu when switching tabs
        const menu = document.getElementById('mobile-menu');
        if (menu) {
          menu.classList.remove('show');
          document.querySelector('.hamburger').classList.remove('active');
        }
        
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // Remove active state from all tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        
        // Show selected tab
        const targetTab = document.getElementById(tabName);
        if (targetTab) {
          targetTab.classList.add('active');
        }
        
        // Add active state to clicked button if it's a tab button
        if (event && event.target.classList.contains('tab-btn')) {
          event.target.classList.add('active');
        }
        
        // Render calendar when switching to schedule tab
        if (tabName === 'schedule-tab') {
          renderCalendar();
        }
      }

      function toggleMenu() {
        const menu = document.getElementById('mobile-menu');
        const hamburger = document.querySelector('.hamburger');
        menu.classList.toggle('show');
        hamburger.classList.toggle('active');
      }

      // Close menu when clicking outside
      document.addEventListener('click', function(event) {
        const menu = document.getElementById('mobile-menu');
        const hamburger = document.querySelector('.hamburger');
        if (!menu.contains(event.target) && !hamburger.contains(event.target)) {
          menu.classList.remove('show');
          hamburger.classList.remove('active');
        }
      });

      function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        document.getElementById('month-year').textContent = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        
        const container = document.getElementById('calendar-days');
        container.innerHTML = '';
        
        // Previous month days
        const prevMonthDays = new Date(year, month, 0).getDate();
        for (let i = startingDayOfWeek - 1; i >= 0; i--) {
          const dayCell = document.createElement('div');
          dayCell.className = 'calendar-day-cell other-month';
          dayCell.textContent = prevMonthDays - i;
          container.appendChild(dayCell);
        }
        
        // Current month days
        for (let day = 1; day <= daysInMonth; day++) {
          const dayCell = document.createElement('div');
          dayCell.className = 'calendar-day-cell';
          dayCell.textContent = day;
          
          const dateObj = new Date(year, month, day);
          const dateStr = dateObj.toISOString().split('T')[0];
          
          // Check for bookings
          if (bookingsData[dateStr]) {
            const bookings = bookingsData[dateStr];
            const hasConfirmed = bookings.some(b => b.status === 'confirmed');
            const hasPending = bookings.some(b => b.status === 'pending');
            const hasRejected = bookings.some(b => b.status === 'rejected');
            
            if (hasConfirmed) {
              dayCell.classList.add('has-confirmed-booking');
            } else if (hasPending) {
              dayCell.classList.add('has-pending-booking');
            } else if (hasRejected) {
              dayCell.classList.add('has-rejected-booking');
            }
          }
          
          // Check if date has slots available for selected service
          const dateSlots = (slotsData[dateStr] || []).filter(s => s.service_type === selectedService);
          
          if (dateSlots && dateSlots.length > 0) {
            dayCell.style.cursor = 'pointer';
            dayCell.style.fontWeight = 'bold';
            dayCell.style.backgroundColor = '#fff3f6';
            dayCell.onclick = () => selectDay(day, dateObj);
          } else {
            dayCell.style.opacity = '0.4';
            dayCell.style.cursor = 'default';
          }
          
          container.appendChild(dayCell);
        }
        
        // Next month days
        const totalCells = container.children.length;
        const remainingCells = 42 - totalCells;
        for (let i = 1; i <= remainingCells; i++) {
          const dayCell = document.createElement('div');
          dayCell.className = 'calendar-day-cell other-month';
          dayCell.textContent = i;
          container.appendChild(dayCell);
        }
      }

      function selectDay(day, dateObj) {
        const dateStr = dateObj.toISOString().split('T')[0];
        const dateSlots = (slotsData[dateStr] || []).filter(s => s.service_type === selectedService);
        
        if (!dateSlots || dateSlots.length === 0) {
          alert('No services available on this date.');
          return;
        }
        
        selectedDate = dateObj;
        selectedSlots = [];
        
        document.getElementById('selected-date-display').textContent = dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        document.getElementById('selected-service-type-input').value = selectedService;
        document.getElementById('hidden-pet-id').value = selectedPetId;
        
        // Show time slot selection
        showTimeSlots(dateSlots);
        
        document.getElementById('slot-modal').classList.add('show');
      }

      function showTimeSlots(dateSlots) {
        const timeSlotsContainer = document.getElementById('time-slots-container');
        timeSlotsContainer.innerHTML = '';
        
        if (selectedService === 'daycare') {
          // Daycare: allow morning and afternoon selection
          const periods = {};
          dateSlots.forEach(slot => {
            const hour = parseInt(slot.start_time.split(':')[0]);
            const period = hour < 12 ? 'morning' : 'afternoon';
            if (!periods[period]) periods[period] = [];
            periods[period].push(slot);
          });
          
          Object.entries(periods).forEach(([period, periodSlots]) => {
            const label = period.charAt(0).toUpperCase() + period.slice(1);
            periodSlots.forEach(slot => {
              const checkboxContainer = document.createElement('div');
              checkboxContainer.className = 'time-slot-option';
              
              // Disable if fully booked
              if (slot.is_fully_booked) {
                checkboxContainer.style.opacity = '0.5';
                checkboxContainer.style.cursor = 'not-allowed';
              }
              
              const checkbox = document.createElement('input');
              checkbox.type = 'checkbox';
              checkbox.id = `period-${slot.id}`;
              checkbox.value = slot.id;
              checkbox.disabled = slot.is_fully_booked;
              checkbox.onchange = (e) => {
                if (e.target.checked) {
                  selectedSlots.push(slot.id);
                } else {
                  selectedSlots = selectedSlots.filter(id => id !== slot.id);
                }
                document.getElementById('selected-slots-input').value = JSON.stringify(selectedSlots);
              };
              
              const label_elem = document.createElement('label');
              label_elem.htmlFor = `period-${slot.id}`;
              const spotsText = slot.is_fully_booked ? '<small style="color: #e74c3c; font-weight: bold;">(FULL)</small>' : `<small style="color: #999;">(${slot.available_spots} spots)</small>`;
              label_elem.innerHTML = `${label} (${slot.start_time} - ${slot.end_time}) ${spotsText}`;
              if (slot.is_fully_booked) {
                label_elem.style.color = '#999';
                label_elem.style.cursor = 'not-allowed';
              }
              
              checkboxContainer.appendChild(checkbox);
              checkboxContainer.appendChild(label_elem);
              timeSlotsContainer.appendChild(checkboxContainer);
            });
          });
        } else {
          // Other services: single selection
          selectedSlots = [];
          dateSlots.forEach(slot => {
            const slotBtn = document.createElement('button');
            slotBtn.type = 'button';
            slotBtn.className = 'time-slot-btn';
            
            // Check if fully booked
            const spotsText = slot.is_fully_booked ? 'FULL - No spots available' : `${slot.available_spots} spots left`;
            slotBtn.innerHTML = `${slot.start_time} - ${slot.end_time}<br><small>${spotsText}</small>`;
            slotBtn.style.padding = '12px';
            slotBtn.style.margin = '8px';
            slotBtn.style.border = '2px solid #ddd';
            slotBtn.style.borderRadius = '6px';
            slotBtn.style.transition = 'all 0.3s';
            
            if (slot.is_fully_booked) {
              // Fully booked styling
              slotBtn.style.backgroundColor = '#f5f5f5';
              slotBtn.style.color = '#999';
              slotBtn.style.borderColor = '#ddd';
              slotBtn.style.cursor = 'not-allowed';
              slotBtn.disabled = true;
              slotBtn.onclick = (e) => {
                e.preventDefault();
                // Show message that slot is full
                alert('This time slot is fully booked. Please select another time.');
              };
            } else {
              // Available slot styling
              slotBtn.style.backgroundColor = 'white';
              slotBtn.style.cursor = 'pointer';
              slotBtn.onclick = (e) => {
                e.preventDefault();
                selectedSlots = [slot.id];
                document.getElementById('selected-slots-input').value = JSON.stringify(selectedSlots);
                
                // Highlight selected
                document.querySelectorAll('.time-slot-btn').forEach(btn => {
                  if (!btn.disabled) {
                    btn.style.backgroundColor = 'white';
                    btn.style.color = 'black';
                    btn.style.borderColor = '#ddd';
                  }
                });
                slotBtn.style.backgroundColor = '#FF6B9D';
                slotBtn.style.color = 'white';
                slotBtn.style.borderColor = '#FF6B9D';
              };
            }
            
            timeSlotsContainer.appendChild(slotBtn);
          });
        }
        
        timeSlotsContainer.style.display = 'block';
        document.getElementById('booking-form-container').style.display = 'block';
      }

      function closeSlotModal() {
        document.getElementById('slot-modal').classList.remove('show');
        selectedDate = null;
        selectedSlots = [];
      }

      function previousMonth() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
      }

      function nextMonth() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
      }

      // Initialize calendar on page load
      document.addEventListener('DOMContentLoaded', function() {
        // Calendar will be rendered when tab is opened or pet/service selected
        // Render mini calendars for pet cards
        renderMiniCalendars();
      });

      // Mini Calendar Generator for Each Pet
      function renderMiniCalendars() {
        const today = new Date();
        
        {% for pet in pets %}
        renderMiniCalendar({{ pet.id }}, petBookingsData);
        {% endfor %}
      }
      
      function renderMiniCalendar(petId, bookingsData) {
        const container = document.getElementById(`mini-grid-${petId}`);
        if (!container) return;

        container.innerHTML = '';

        // Create day name headers (7 columns for Sun-Sat)
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        dayNames.forEach(day => {
          const header = document.createElement('div');
          header.className = 'mini-cal-day-header';
          header.textContent = day;
          container.appendChild(header);
        });

        // Get today's date
        let currentDate = new Date();
        currentDate.setHours(0, 0, 0, 0);

        // Generate 15 days starting from today
        for (let i = 0; i < 15; i++) {
          const date = new Date(currentDate);
          date.setDate(date.getDate() + i);
          date.setHours(0, 0, 0, 0);

          const dayCell = document.createElement('div');
          dayCell.className = 'mini-cal-day';
          dayCell.textContent = date.getDate();

          // Check if it's today
          if (date.getTime() === currentDate.getTime()) {
            dayCell.classList.add('today');
          }

          // Check if pet has bookings on this date
          const dateStr = date.toISOString().split('T')[0];
          if (bookingsData && bookingsData[petId] && bookingsData[petId][dateStr]) {
            const bookings = bookingsData[petId][dateStr];
            const hasConfirmed = bookings.some(b => b.status === 'confirmed');
            const hasPending = bookings.some(b => b.status === 'pending');
            
            // Show service types in tooltip
            const services = bookings.map(b => `${b.service} (${b.time})`).join(', ');
            dayCell.title = services;
            
            dayCell.classList.add('has-booking');
            if (hasConfirmed) {
              dayCell.classList.add('confirmed');
            } else if (hasPending) {
              dayCell.classList.add('pending');
            }
          }

          container.appendChild(dayCell);
        }
      }

      // Render MAIN calendar for schedule tab
      function renderMainCalendar() {
        const container = document.getElementById('main-calendar');
        if (!container) return;

        container.innerHTML = '';
        
        // Create 7-day header
        const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        daysOfWeek.forEach(day => {
          const dayHeader = document.createElement('div');
          dayHeader.className = 'large-cal-day-header';
          dayHeader.textContent = day;
          container.appendChild(dayHeader);
        });

        // Render 35 days (5 weeks) starting from today
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Go to start of week (Sunday)
        const startDate = new Date(today);
        startDate.setDate(startDate.getDate() - startDate.getDay());

        for (let i = 0; i < 35; i++) {
          const currentDate = new Date(startDate);
          currentDate.setDate(startDate.getDate() + i);
          
          const dayCell = document.createElement('div');
          dayCell.className = 'large-cal-day';
          
          // Make clickable for future dates
          if (currentDate >= today) {
            dayCell.style.cursor = 'pointer';
            dayCell.onclick = () => openDateBookingModal(currentDate);
          }
          
          // Day number
          const dayNumber = document.createElement('div');
          dayNumber.className = 'large-cal-day-number';
          dayNumber.textContent = currentDate.getDate();
          dayCell.appendChild(dayNumber);
          
          // Check if it's today
          if (currentDate.toDateString() === today.toDateString()) {
            dayCell.classList.add('today');
          }
          
          // Check if it's a different month
          if (currentDate.getMonth() !== today.getMonth()) {
            dayCell.classList.add('other-month');
          }
          
          // Check for bookings on this date
          const dateStr = currentDate.toISOString().split('T')[0];
          if (bookingsData[dateStr]) {
            dayCell.classList.add('has-booking');
            bookingsData[dateStr].forEach(booking => {
              const badge = document.createElement('div');
              badge.className = `booking-badge ${booking.status}`;
              badge.innerHTML = `
                <div style="font-weight: 700;">${booking.service_type}</div>
                <div class="booking-time">‚è∞ ${booking.start_time}</div>
              `;
              dayCell.appendChild(badge);
            });
          }
          
          container.appendChild(dayCell);
        }
      }

      // SIMPLIFIED BOOKING: Show calendar, click day, modal for pet/service/time
      function openDateBookingModal(dateObj) {
        if (!dateObj) return;
        
        selectedDate = dateObj;
        const dateStr = dateObj.toLocaleDateString('en-US', { 
          weekday: 'short', 
          month: 'short', 
          day: 'numeric' 
        });
        
        document.getElementById('modal-selected-date').textContent = dateStr;
        document.getElementById('service-options').innerHTML = '';
        document.getElementById('time-slots-container').innerHTML = '';
        
        // Get unique services for this date
        const dateKey = dateObj.toISOString().split('T')[0];
        const availableServices = slotsData[dateKey] ? 
          [...new Set(slotsData[dateKey].map(s => s.service_type))] : [];
        
        if (availableServices.length === 0) {
          alert('No services available on this date. Please choose another day.');
          return;
        }
        
        // Populate service buttons
        availableServices.forEach(service => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.textContent = service.toUpperCase();
          btn.style.padding = '10px';
          btn.style.background = '#f0f0f0';
          btn.style.color = '#333';
          btn.style.border = '2px solid #e0e0e0';
          btn.style.borderRadius = '8px';
          btn.style.cursor = 'pointer';
          btn.style.fontWeight = '600';
          btn.style.transition = 'all 0.3s';
          btn.onclick = () => selectServiceForDate(service, dateKey);
          document.getElementById('service-options').appendChild(btn);
        });
        
        // Show modal
        document.getElementById('slot-modal').classList.add('show');
      }
      
      function selectServiceForDate(service, dateKey) {
        selectedService = service;
        document.getElementById('selected-service-type-input').value = service;
        
        // Update button styles
        document.querySelectorAll('#service-options button').forEach(btn => {
          if (btn.textContent === service.toUpperCase()) {
            btn.style.background = '#4ECDC4';
            btn.style.color = 'white';
            btn.style.borderColor = '#4ECDC4';
          } else {
            btn.style.background = '#f0f0f0';
            btn.style.color = 'black';
            btn.style.borderColor = '#e0e0e0';
          }
        });
        
        // Show time slots for this service on this date
        const slots = (slotsData[dateKey] || []).filter(s => s.service_type === service);
        showTimeSlotsForBooking(slots);
      }
      
      function showTimeSlotsForBooking(slots) {
        const container = document.getElementById('time-slots-container');
        container.innerHTML = '';
        
        if (slots.length === 0) {
          container.innerHTML = '<p style="color: var(--gray);">No time slots available.</p>';
          return;
        }
        
        slots.forEach(slot => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.innerHTML = `${slot.start_time} - ${slot.end_time}<br><small style="opacity: 0.7;">${slot.available_spots} spots</small>`;
          btn.style.padding = '12px';
          btn.style.background = slot.is_fully_booked ? '#f0f0f0' : 'white';
          btn.style.color = '#333';
          btn.style.border = '2px solid #e0e0e0';
          btn.style.borderRadius = '8px';
          btn.style.cursor = slot.is_fully_booked ? 'not-allowed' : 'pointer';
          btn.style.fontWeight = '600';
          btn.style.transition = 'all 0.3s';
          btn.style.opacity = slot.is_fully_booked ? '0.5' : '1';
          
          if (!slot.is_fully_booked) {
            btn.onmouseover = () => btn.style.borderColor = '#4ECDC4';
            btn.onmouseout = () => btn.style.borderColor = '#e0e0e0';
            btn.onclick = (e) => {
              e.preventDefault();
              
              // Just select the time slot - don't submit yet
              selectedSlots = [slot.id];
              document.getElementById('selected-slots-input').value = JSON.stringify([slot.id]);
              
              // Update button styling to show it's selected
              document.querySelectorAll('#time-slots-container button').forEach(b => {
                b.style.background = 'white';
                b.style.borderColor = '#e0e0e0';
                b.style.color = '#333';
              });
              
              btn.style.background = '#4ECDC4';
              btn.style.borderColor = '#4ECDC4';
              btn.style.color = 'white';
            };
          } else {
            btn.style.cursor = 'not-allowed';
          }
          
          container.appendChild(btn);
        });
      }
      
      function validateBookingForm(event) {
        // Check if pet is selected
        const petId = document.getElementById('booking-pet-select').value;
        if (!petId) {
          alert('Please select a pet before booking.');
          event.preventDefault();
          return false;
        }
        
        // Check if service is selected
        const serviceType = document.getElementById('selected-service-type-input').value;
        if (!serviceType) {
          alert('Please select a service type before booking.');
          event.preventDefault();
          return false;
        }
        
        // Check if time slot is selected
        const slots = document.getElementById('selected-slots-input').value;
        if (!slots) {
          alert('Please select a time slot before booking.');
          event.preventDefault();
          return false;
        }
        
        // All validations passed
        return true;
      }
      
      function updatePetSelection() {
        const petId = document.getElementById('booking-pet-select').value;
        document.getElementById('hidden-pet-id').value = petId;
      }

      // Initialize calendars
      function initializeCalendars() {
        // Mini calendars on feed tab
        Object.keys(petBookingsData).forEach(petId => {
          renderMiniCalendar(petId, petBookingsData[petId]);
        });
        
        // Main calendar on schedule tab
        renderMainCalendar();
      }
      
      // Initialize when document is ready
      document.addEventListener('DOMContentLoaded', initializeCalendars);

      // Close modal when clicking outside
      document.getElementById('slot-modal').addEventListener('click', function(event) {
        if (event.target === this) {
          closeSlotModal();
        }
      });

      // Auto-refresh feed every 30 seconds
      setInterval(() => {
        const feedTab = document.getElementById('feed-tab');
        if (feedTab.classList.contains('active')) {
          location.reload();
        }
      }, 30000);
    </script>
    {% include 'footer.html' %}
  </body>
</html>
